<section class="live-tracking-wrapper">
    <app-page-title [pageTitle]="'Tracking'"></app-page-title>
    <div class="rider-wrapper__tools row align-items-end mb-3">
        <div class="col-3 input-details">
            <label for="areaCode" class="input-heading">Rider Status</label>
            <ng-select placeholder="Select Status" [multiple]="true" [closeOnSelect]="false" [(ngModel)]="filterByRiderStatus">
                <ng-container *ngFor="let status of riderStatusList | keyvalue">
                    <ng-option [value]="status.key" *ngIf="status.key !== 'offline'">
                        {{status.value}}
                    </ng-option>
                </ng-container>
            </ng-select>
        </div>
        <div class="col-3 input-details">
            <label for="search" class="input-heading">Max Riders</label>
            <input type="text" class="input-field" placeholder="search..." name="search" [(ngModel)]="filterByRiderCount">
        </div>
        <div class="col-2">
            <button class="buttons br-50" (click)="getLiveTracking()">Apply Filter</button>
        </div>
        
        <!-- Legend -->
        <div class="legend d-flex col-4">
            <div class="legend-item">
                <img src="https://maps.google.com/mapfiles/ms/icons/green-dot.png" alt="Idle">
            <span>Idle</span>
            </div>
            <div class="legend-item">
                <img src="https://maps.google.com/mapfiles/ms/icons/red-dot.png" alt="Busy">
            <span>Busy</span>
            </div>
            <div class="legend-item">
                <img src="https://maps.google.com/mapfiles/ms/icons/blue-dot.png" alt="Allocating">
                <span>Allocating</span>
            </div>
            <div class="legend-item">
                <img src="https://maps.google.com/mapfiles/ms/icons/pink-dot.png" alt="Other">
                <span>Other</span>
            </div>
        </div>
  </div>

  <!-- op/black Zone Switch -->
  <div class="col-12">
    <span class="d-flex align-items-center gap-2">
        <label class="input-heading">Operational Zones</label>
        <input class="me-5" type="checkbox" [ngClass]="{'active': showOpZonePolygons}" role="switch"
            name="toggle" (click)="toggleOpZonePolygons()">

        <label class="input-heading">Black Zones</label>
        <input class="me-3" type="checkbox" [ngClass]="{'active': showBlackZonePolygons}" role="switch"
            name="toggle" (click)="toggleBlackZonePolygons()">
    </span>
 </div>

  <div class="d-flex row mt-4 align-items-center" *ngIf="showRiderCount">
    <span class="col-4">
        <label class="input-heading">Total Idle Rider</label>
        <input class="input-field ms-3" type="text" [(ngModel)]="idleRiderCount" readonly>
    </span>
    <span class="col-4">
        <label class="input-heading">Total Busy Rider</label>
        <input class="input-field ms-3" type="text" [(ngModel)]="busyRiderCount" readonly>
    </span>
    <span class="col-4">
        <label class="input-heading">Total Allocating Rider</label>
        <input class="input-field ms-3" type="text" [(ngModel)]="allocatingRiderCount" readonly>
    </span>
</div>
    <main class="live-tracking-wrapper__content mt-3">
        <agm-map [latitude]="mapLatitude" [longitude]="mapLongitude" [zoom]="12" (mapReady)="onMapReady($event)" (boundsChange)="onBoundsChange($event)">
            <agm-marker *ngFor="let rider of riderTrackingList" [latitude]="rider.latitude" [longitude]="rider.longitude" [markerDraggable]="false" [iconUrl]="getMarkerIcon(rider.riderStatus)">      
                    <agm-info-window class="d-flex align-items-center" [disableAutoPan]="true">
                        <img class="rounded-circle me-2" src="{{rider.image}}" alt="" width="20" height="20">
                        <span class="d-flex flex-column justify-content-between align-items-center">{{ rider.riderName }}
                            <label> [{{rider.riderStatus}}]</label>
                        </span>
                </agm-info-window>
            </agm-marker>
        </agm-map>
    </main>
</section>